# Do NOT edit this file unless you really know what you are doing
SET(CMAKE_COLOR_MAKEFILE ON)
cmake_minimum_required(VERSION 3.16)
cmake_policy(SET CMP0076 NEW)

# Set project name
project(geophysics-netcdf VERSION 1.0 DESCRIPTION "C++ interface for handling GA's Geophysical NetCDF data format" LANGUAGES CXX)
message(STATUS "Configuring geophysics-netcdf")

include(cmake/Message-Functions.cmake)

# Set the C++ standard to C++17
set(CMAKE_CXX_STANDARD 17)

# Set the compile flags
if(MSVC)
	add_compile_options(/O2)
	add_compile_definitions(_CRT_SECURE_NO_WARNINGS)
	add_compile_definitions(_SILENCE_ALL_CXX17_DEPRECATION_WARNINGS)
else()
	add_compile_options(-Wno-unused-but-set-variable -Wno-sign-compare -Wno-format-security -Wno-tautological-constant-compare)
	link_libraries(-lstdc++fs)
endif()

if(CMAKE_COMPILER_IS_GNUCC)
	add_compile_options(-Wno-unused-result -Wno-date-time -Wno-error=date-time)
	#On GCC, even with -Wno-date-time, still get warings of the form: warning: macro "__DATE__" might prevent reproducible builds [-Wdate-time]
endif()

# Find PkgConfig
find_package(PkgConfig QUIET)

# Configure NetCDF C++ Libraries
include(cmake/Configure-NetCDF_CXX.cmake)

# Add the cpp-utils submodule with CGAL turned OFF as it is not needed
# set(WITH_CGAL OFF CACHE BOOL "Build cpp-utils library without CGAL" FORCE)
add_subdirectory(submodules/cpp-utils EXCLUDE_FROM_ALL)

set(sources ${sources} src/geophysics_netcdf.cpp)

# Add the static library
set(target geophysics-netcdf-static)
add_library(${target} STATIC)
set_target_properties(${target} PROPERTIES LINKER_LANGUAGE CXX)
set_target_properties(${target} PROPERTIES PUBLIC_HEADER include/geophysics_netcdf.hpp)
target_sources(${target} PUBLIC ${sources})
target_include_directories(${target} PUBLIC "$<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/include>")
target_include_directories(${target} PUBLIC "$<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/submodules/marray/include/andres>")
target_link_libraries(${target} PUBLIC cpp-utils::static)
target_link_libraries(${target} PUBLIC NETCDF::CXX)
install(TARGETS ${target} OPTIONAL)

# Add an alias target
add_library(geophysics-netcdf::static ALIAS ${target})

